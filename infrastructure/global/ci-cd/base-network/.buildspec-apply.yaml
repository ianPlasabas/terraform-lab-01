version: 0.2

env:
  variables:  
    TF_WORKING_DIR: "infrastructure/env/dev/base-network"

phases:
  install: 
    commands: 
      - echo "Installing Terraform..."
      - wget https://releases.hashicorp.com/terraform/1.13.4/terraform_1.13.4_linux_amd64.zip -O /tmp/terraform.zip
      - unzip -o /tmp/terraform.zip -d /usr/local/bin
      - terraform -version

    
  pre_build: 
    commands:
      - echo "Prepraing Directory Path.."
      - cd $TF_WORKING_DIR
      - pwd
      - ls -la
      - terraform init -input=false -reconfigure

  build:
    commands:
      - echo "Applying saved plan..."
      - terraform init -input=false
      - terraform apply -input=false tfplan.binary

artifacts:
  files: []
